"use strict";(globalThis["webpackChunkcom_smart_meter_reading"]=globalThis["webpackChunkcom_smart_meter_reading"]||[]).push([[323],{1323:(e,a,t)=>{t.r(a),t.d(a,{default:()=>ce});var s=t(9835),r=t(6970);const o={class:"container"},l={key:0,class:"text-center"},n=(0,s._)("p",null,"Loading...",-1),c={key:1,class:"row justify-content-center"},i={class:"col-md-12 q-mb-lg"},d={class:"card"},m={class:"top-bg text-center"},u=(0,s._)("img",{src:"path/to/mycities-logo.png",alt:"Logo"},null,-1),_=(0,s._)("p",null,"Madina Tower",-1),v=(0,s._)("h3",{class:"q-my-sm"},"Saleem Essop, Apartment 138",-1),y={class:"q-mb-sm"},p={class:"card-body"},w=(0,s._)("div",{class:"summary-card q-my-sm"},[(0,s._)("p",{class:"summary"},"Account Summary")],-1),g={class:"heading-bg row items-center"},f={class:"col-6"},b={class:"mb-0"},h={class:"col-6 text-end"},D={class:"row g-0"},k={class:"col-12"},I={key:0,class:"row data-row justify-between"},q=(0,s._)("div",{class:"col-8"},[(0,s._)("p",null,"Balance B/F")],-1),z={class:"col-4"},x={class:"end"},Y={key:0,class:"col-12"},N={class:"row data-row justify-between"},R={class:"col-8"},M={class:""},S={class:"col-4 text-end"},j={class:"end"},F={class:"col-12"},P={class:"row data-row justify-content-between mb-2"},A=(0,s._)("div",{class:"col-8"},[(0,s._)("p",{class:""},"Balance Carried")],-1),C={class:"col-4 text-left"},Z={class:"end"},B={key:0,class:"payments-section"},O=(0,s._)("div",{class:"heading-bg row items-center"},[(0,s._)("div",{class:"col"},[(0,s._)("h5",null,"Payments Details")])],-1),T={class:"col-8"},H=(0,s._)("p",{class:"text-bold"},"Amount",-1),K={class:"col-4 end"},L={class:"text-bold"},E=(0,s._)("hr",null,null,-1),Q={class:"row"},U={class:"col-12 bg-body payment q-my-md"},W={key:0,class:"btn btn-success btn-lg"},$={class:"row items-center justify-center total-bill"},G={class:"col-12 text-center"},J={key:0},V={key:1};function X(e,a,t,X,ee,ae){const te=(0,s.up)("q-spinner");return(0,s.wg)(),(0,s.iD)("div",o,[ee.summary.length<=0?((0,s.wg)(),(0,s.iD)("div",l,[(0,s.Wm)(te,{color:"primary",size:"3em"}),n])):((0,s.wg)(),(0,s.iD)("div",c,[(0,s._)("div",i,[(0,s._)("div",d,[(0,s._)("div",m,[u,_,v,(0,s._)("h6",y,"Current Date: "+(0,r.zw)(ee.currentDate),1)]),(0,s._)("div",p,[w,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(ee.summary,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{key:a},[(0,s._)("div",g,[(0,s._)("div",f,[(0,s._)("p",b,(0,r.zw)(e.period),1)]),(0,s._)("div",h,[(0,s._)("h6",null,"R "+(0,r.zw)(ae.formatNumber(e.total_amount)),1)])]),(0,s._)("div",D,[(0,s._)("div",k,[e.balance_bf?((0,s.wg)(),(0,s.iD)("div",I,[q,(0,s._)("div",z,[(0,s._)("p",x,"R "+(0,r.zw)(ae.formatNumber(e.balance_bf)),1)])])):(0,s.kq)("",!0)]),e.payment_date?((0,s.wg)(),(0,s.iD)("div",Y,[(0,s._)("div",N,[(0,s._)("div",R,[(0,s._)("p",M," Payment "+(0,r.zw)(ae.formatDate(e.payment_date)),1)]),(0,s._)("div",S,[(0,s._)("p",j," R "+(0,r.zw)(ae.formatNumber(e.payment_amount)),1)])])])):(0,s.kq)("",!0),(0,s._)("div",F,[(0,s._)("div",P,[A,(0,s._)("div",C,[(0,s._)("p",Z," R "+(0,r.zw)(ae.formatNumber(e.balance_carried)),1)])])])]),e.payments&&e.payments.length>0?((0,s.wg)(),(0,s.iD)("div",B,[O,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.payments,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{key:a,class:"row q-mb-sm"},[(0,s._)("div",T,[H,(0,s._)("p",null,"Status: "+(0,r.zw)(e.status),1)]),(0,s._)("div",K,[(0,s._)("p",L," R "+(0,r.zw)(ae.formatNumber(e.amount)),1),(0,s._)("p",null,"Paid: R "+(0,r.zw)(ae.formatNumber(e.paid_amount)),1)]),E])))),128))])):(0,s.kq)("",!0)])))),128))]),(0,s._)("div",Q,[(0,s._)("div",U,[ee.overdueInfo?((0,s.wg)(),(0,s.iD)("button",W," Payment Overdue ")):(0,s.kq)("",!0)])]),(0,s._)("div",$,[(0,s._)("div",G,[ee.overdueInfo?((0,s.wg)(),(0,s.iD)("h2",J," R "+(0,r.zw)(ae.formatNumber(ee.overdueInfo.amount)),1)):(0,s.kq)("",!0),ee.overdueInfo?((0,s.wg)(),(0,s.iD)("p",V,(0,r.zw)(ee.overdueInfo.period),1)):(0,s.kq)("",!0)])])])])]))])}var ee=t(8339),ae=t(4170);const te={data(){return{summary:[],overdueInfo:null,loading:!0,error:null,meterId:null,currentDate:ae.ZP.formatDate(Date.now(),"DD MMM YYYY")}},mounted(){const e=(0,ee.yj)();this.meterId=e.params.id,this.fetchSummary()},methods:{async fetchSummary(){if(!this.meterId)return this.error="Cannot fetch summary: meterId is not set",void(this.loading=!1);try{const e=await this.$api.get("/v1/meter/account-summary",{params:{meter_id:this.meterId}});console.log("Raw response:",e),!0===e.status?Array.isArray(e.data)?(this.summary=e.data,this.calculateOverdueInfo()):(console.error("Unexpected response format:",e),this.error="Failed to fetch usage data: Invalid response format"):this.error="Failed to fetch usage data: Server returned status "+e.status}catch(t){var e,a;this.error="Failed to fetch usage data: "+((null===(e=t.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||t.message),console.error("Fetch error:",t)}finally{this.loading=!1}},calculateOverdueInfo(){const e=this.summary.find((e=>!0===e.is_overdue));this.overdueInfo=e?{amount:e.balance_carried,period:e.period}:null},formatNumber(e){return Number(e).toFixed(2)},formatDate(e){return e?ae.ZP.formatDate(e,"D MMM YYYY"):""}}};var se=t(1639),re=t(3940),oe=t(9984),le=t.n(oe);const ne=(0,se.Z)(te,[["render",X]]),ce=ne;le()(te,"components",{QSpinner:re.Z})}}]);